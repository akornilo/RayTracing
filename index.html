<body>
  <canvas id="myCanvas" width="400" height="400"></canvas>
  <script>

	var eyeX = 200.0;
	var eyeY = 200.0;
	var eyeZ = -100.0;

	var spheres = Array(Array(100.0, 200.0, 200.0, 100.0), Array(50.0, 10.0, 100.0, 150.00), Array(50.0, 200.0, 50.0, 100.00));	
	
	function hit (rayX, rayY, rayZ, xPos, yPos, zPos) {

	//check spheres first
	var color = new Array(8);
	var t = Math.min();

		for(var i = 0; i < spheres.length; i++) {
			var v = rayX*(spheres[i][1]-xPos)+rayY*(spheres[i][2]-yPos)+rayZ*(spheres[i][3]);
			var disc = Math.pow(spheres[i][0],2) - ((Math.pow(spheres[i][1]-xPos,2)+Math.pow(spheres[i][2]-yPos,2)+Math.pow(spheres[i][3],2)) - v*v);
			if( disc >= 0 && (v-Math.sqrt(disc)) < t) {

				t = v - Math.sqrt(disc);
				color[0] = 255;
				color[1] = 0;
				color[2] = 0;
				color[3] = t;
				var pointX = xPos + t * rayX;
				var pointY = yPos + t * rayY;
				var pointZ =  zPos + t * rayZ;

				var normX = spheres[i][1] - pointX;
				var normY = spheres[i][2] - pointY;
				var normZ = spheres[i][3] - pointZ;

				var mag = Math.pow(normX*normX + normY*normY + normZ * normZ, 0.5);
				normX /= mag;
				normY /= mag;
				normZ /= mag;
				color[4] = normX;
				color[5] = normY;
				color[6] = normZ;
				color[7] = true;
			}
		}
		
	// walls and floors

		if (t == Math.min()) {
			if( yPos / rayY > 0) {
			t = yPos / rayY;
			color[0] = 0;
			color[1] = 255;
			color[2] = 0;
			color[3] = t;
			color[4] = 0;
			color[5] = 1;
			color[6] = 0;
			color[7] = false;
			}
			else {
			color[0] = 10;
			color[1] = 2;
			color[2] = 255;
			color[3] = t;
			}
		}	
		return color;
	}


	function hitSphere(rayX, rayY, rayZ, xPos, yPos, zPos) {

		for(var i = 0; i < spheres.length; i++) {
			var v = rayX*(spheres[i][1]-xPos)+rayY*(spheres[i][2]-yPos)+rayZ*(spheres[i][3]);
			var disc = Math.pow(spheres[i][0],2) - ((Math.pow(spheres[i][1]-xPos,2)+Math.pow(spheres[i][2]-yPos,2)+Math.pow(spheres[i][3],2)) - v*v);
			if( disc >= 0 ) {
				console.log(xPos, zPos);				
				return true;
			}
		}

		return false;
	}


	var calculatePixel = function(data, index) {


	var yPos = Math.round((index / 4) / 400);
	var xPos = (index / 4) % 400;

	
	
	//calculate direction

	var rayX = Math.pow((xPos-eyeX),2);
	var rayY = Math.pow((yPos-eyeY),2);
	var rayZ = (eyeZ*eyeZ);
	var magnitude = Math.pow((rayX+rayY+rayZ), 0.5);

	rayX = (xPos-eyeX)/magnitude;
	rayY = (yPos-eyeY)/magnitude;
	rayZ = (-eyeZ)/magnitude;
	
	//[r,g,b,t,nX,nY,nZ]
	var results = hit(rayX, rayY, rayZ, xPos, yPos, 0);

	var derp = 1;
	if(results[3] != Math.min()) {
	var pointX = xPos + results[3] * rayX;
	var pointY = yPos + results[3] * rayY;
	var pointZ =  results[3] * rayZ;

	var sunX = 300;
	var sunY = 10;
	var sunZ = -10;

	var sunVX = sunX - pointX;
	var sunVY = sunY - pointY;
	var sunVZ = sunZ - pointZ;
	var mag = Math.pow( sunVX * sunVX + sunVY * sunVY + sunVZ * sunVZ, 0.5);

	sunVX /= mag;
	sunVY /= mag;
	sunVZ /= mag;

	derp = -1 * (sunVX*results[4] + sunVY * results[5] + sunVZ * results[6]);
	
	if (derp < 0) derp = 0;
}

	data[index] = results[0] * (.4 + .6 * derp);
	data[index+1] = results[1] * (.4 + .6 * derp);
	data[index+2] = results[2] * (.4 + .6 * derp);
	data[index+3] = 255;
		

	}

    var canvas = document.getElementById('myCanvas');
    var context = canvas.getContext('2d');

	var imgData = context.createImageData(400,400);
	var data = imgData.data;

	for(var i=0; i < (400*400*4); i+=4) {
		calculatePixel(data, i);
	
	}	

	context.putImageData(imgData, 0, 0);
  </script>
</body>
